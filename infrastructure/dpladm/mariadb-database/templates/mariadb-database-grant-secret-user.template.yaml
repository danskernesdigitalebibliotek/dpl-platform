apiVersion: k8s.mariadb.com/v1alpha1
kind: Database
metadata:
  name: database-{{ .Release.Namespace }}
spec:
  characterSet: LATIN1
  cleanupPolicy: Delete
  collate: LATIN1_SWEDISH_CI
  mariaDbRef:
    name: mariadb-10-06-01-test
    namespace: mariadb-10-06-01-test
    waitForIt: true
  requeueInterval: 30s
  retryInterval: 5s

---

apiVersion: v1
kind: Secret
metadata:
  name: secret-database-{{ .Release.Namespace }}
stringData:
  password: {{ .Values.password }}

---
apiVersion: k8s.mariadb.com/v1alpha1
kind: User
metadata:
  name: user-database-{{ .Release.Namespace }}
spec:
  mariaDbRef:
    name: mariadb-10-06-01-test
    namespace: mariadb-10-06-01-test
    waitForIt: true
  passwordSecretKeyRef:
    name: secret-database-{{ .Release.Namespace }}
    key: password
  maxUserConnections: 50

---

apiVersion: k8s.mariadb.com/v1alpha1
kind: Grant
metadata:
  name: grant-database-{{ .Release.Namespace }}
spec:
  cleanupPolicy: Delete
  database: database-{{ .Release.Namespace }}
  grantOption: true
  host: '%'
  mariaDbRef:
    name: mariadb-10-06-01-test
    namespace: mariadb-10-06-01-test
    waitForIt: true
  privileges:
  - ALL PRIVILEGES
  requeueInterval: 30s
  retryInterval: 5s
  table: '*'
  username: user-database-{{ .Release.Namespace }}
